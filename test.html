<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Average Grade</title>
  <style>
    body {
      display: flex;
      justify-content: center;
    }

    fieldset {
      margin: 1em 0;
    }

    input {
      width: 4em;
    }

    input:out-of-range {
      outline: 1px solid red;
    }

    output {
      display: block;
      height: 1em;
      margin: 0.25em;
    }
  </style>
</head>

<body>
  <form>
    <fieldset>
      <legend>Physics</legend>
      <input type="number" step="any" min="0" max="100">
      <input type="number" step="any" min="0" max="100">
      <input type="number" step="any" min="0" max="100">
      <input type="number" step="any" min="0" max="100">
      <input type="number" step="any" min="0" max="100">
      <output></output>
    </fieldset>
    <fieldset>
      <legend>History</legend>
      <input type="number" step="any" min="0" max="100">
      <input type="number" step="any" min="0" max="100">
      <input type="number" step="any" min="0" max="100">
      <input type="number" step="any" min="0" max="100">
      <input type="number" step="any" min="0" max="100">
      <output></output>
    </fieldset>
    <button type="button">Calculate</button>
  </form>

  <script>
    var form = document.querySelector('form');
    var max = Number(form.querySelectorAll('input')[0].max);

    function validateAndAverageGrades(course) {
      var total = 0;
      var count = 0;
      var inputs = course.querySelectorAll('input');
      for (var input of inputs) {
        var grade = input.value;
        if (grade && 0 <= grade && grade <= max) {
          total += Number(grade);
          count++;
        } else if (grade) {
          return 'You may only enter 0 to ' + max + '.';
        }
      }
      return total / count;
    }

    function displayErrorMessagesAndAverages() {
      var fieldsets = form.querySelectorAll('fieldset');
      for (var fieldset of fieldsets) {
        var output = fieldset.querySelector('output');
        var returnValue = validateAndAverageGrades(fieldset);
        if (typeof returnValue == 'string') {
          output.value = returnValue;
        } else if (isNaN(returnValue)) {
          output.value = 'Please enter a grade.';
        } else {
          output.value = 'Average: ' + returnValue.toFixed(1);
        }
      }
    }

    form.querySelector('button').addEventListener('click', function() {
      displayErrorMessagesAndAverages();
    });
  </script>
</body>

</html>
