<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Class Activity Calculator</title>
<style>
input {
  width: 4em;
}
</style>
  </head>
  <body>

<form id="form">
  <fieldset id="listening">
    <legend>Listening & Speaking</legend>
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <output id="listeningAverage"></output>
  </fieldset>
  <fieldset id="reading">
    <legend>Reading</legend>
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <output id="readingAverage"></output>
  </fieldset>
  <fieldset id="writing">
    <legend>Writing</legend>
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <input type="number" step="0.1">
    <output id="writingAverage"></output>
  </fieldset>
  <button type="button" id="calculator">Calculate</button>
  <output id="classActivity"></output>
  <button type="button" id="resetter">Reset</button>
</form>

<script>
var i;

function detectChanges() {
  var inputs = document.querySelectorAll('input');
  for (i = 0; i < inputs.length; i++) {
    if (inputs[i].value) {
      return true;
    }
  }
}

function calculateAverage(grades) {
  var total = 0;
  var count = 0;
  for (i = 0; i < grades.length; i++) {
    if (grades[i].value) {
      total += Number(grades[i].value);
      count++;
    }
  }
  return total / count;
}

function displayAverage(grades) {
  var avg = calculateAverage(grades);
  if (isNaN(avg)) {
    return 'Please enter a grade.';
  } else {
    return 'Average: ' + avg.toFixed(1);
  }
}

document.getElementById('calculator').addEventListener('click', function() {
  var listeningGrades = document.querySelectorAll('#listening > input');
  var listeningAverage = document.getElementById('listeningAverage');
  listeningAverage.value = displayAverage(listeningGrades);

  var readingGrades = document.querySelectorAll('#reading > input');
  var readingAverage = document.getElementById('readingAverage');
  readingAverage.value = displayAverage(readingGrades);

  var writingGrades = document.querySelectorAll('#writing > input');
  var writingAverage = document.getElementById('writingAverage');
  writingAverage.value = displayAverage(writingGrades);

  var classActivity = document.getElementById('classActivity');
  var averagesTotal = (calculateAverage(listeningGrades) * 4 + calculateAverage(readingGrades) * 3 + calculateAverage(writingGrades) * 1) / 8;
  // skill average * its weight; weights total = 8
  if (isNaN(averagesTotal)) {
    classActivity.value = '';
  } else {
    classActivity.value = 'Class activity: ' + averagesTotal.toFixed(1);
  }
});

document.getElementById('resetter').addEventListener('click', function() {
  if (detectChanges() && confirm('Your changes will be lost.\nAre you sure you want to reset?')) {
    document.getElementById('form').reset();
  }
});

window.addEventListener('beforeunload', function(event) {
  if (detectChanges()) {
    event.returnValue = 'Your changes may be lost.';
  }
});
</script>

  </body>
</html>
